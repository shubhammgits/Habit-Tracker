(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{70344:(e,t,s)=>{"use strict";s.d(t,{D:()=>l,ThemeProvider:()=>r});var a=s(12115);function i(e){document.documentElement.classList.toggle("dark","dark"===e)}function r(e){let{children:t}=e;return a.useEffect(()=>{var e,t,s;let a=null!=(s=localStorage.getItem("ht_theme"))?s:null,r=null==(e=(t=window).matchMedia)?void 0:e.call(t,"(prefers-color-scheme: dark)").matches;i(null!=a?a:r?"dark":"light")},[]),t}function l(){let[e,t]=a.useState("light");a.useEffect(()=>{t(document.documentElement.classList.contains("dark")?"dark":"light")},[]);let s=a.useCallback(()=>{let s="dark"===e?"light":"dark";t(s),localStorage.setItem("ht_theme",s),i(s)},[e]);return{theme:e,toggle:s}}},78375:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var a=s(95155),i=s(12115),r=s(85947),l=s(70344);function n(){let{theme:e,toggle:t}=(0,l.D)();return(0,a.jsxs)("button",{onClick:t,className:"relative inline-flex h-9 w-[74px] items-center rounded-full border border-border bg-card/60 px-1 outline-none focus-visible:ring-2 focus-visible:ring-ring","aria-label":"Toggle theme",children:[(0,a.jsx)(r.P.span,{className:"absolute left-1 top-1 h-7 w-7 rounded-full bg-foreground/10",animate:{x:35*("dark"===e)},transition:{type:"spring",stiffness:500,damping:30}}),(0,a.jsxs)("span",{className:"flex w-full items-center justify-between px-2 text-xs text-muted-foreground",children:[(0,a.jsx)("span",{children:"☀"}),(0,a.jsx)("span",{children:"☾"})]})]})}let d=(0,s(95988).vt)(e=>({habits:[],selectedHabitId:null,loading:!1,error:null,setSelectedHabitId:t=>e({selectedHabitId:t}),refresh:async t=>{e({loading:!0,error:null});try{let s=await fetch("/api/habits?date=".concat(encodeURIComponent(t)));if(!s.ok){let e=await s.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Failed to load habits")}let a=await s.json();e(e=>{var t,s;let i=e.selectedHabitId,r=i&&a.habits.some(e=>e.id===i)?i:null!=(s=null==(t=a.habits[0])?void 0:t.id)?s:null;return{habits:a.habits,selectedHabitId:r,loading:!1}})}catch(t){var s;e({loading:!1,error:null!=(s=null==t?void 0:t.message)?s:"Failed to load habits"})}},upsertLocal:t=>e(e=>{var s;return{habits:[t,...e.habits.filter(e=>e.id!==t.id)],selectedHabitId:null!=(s=e.selectedHabitId)?s:t.id}}),removeLocal:t=>e(e=>{var s,a;return{habits:e.habits.filter(e=>e.id!==t),selectedHabitId:e.selectedHabitId===t?null!=(a=null==(s=e.habits.find(e=>e.id!==t))?void 0:s.id)?a:null:e.selectedHabitId}}),setCompletedTodayLocal:(t,s)=>e(e=>({habits:e.habits.map(e=>e.id===t?{...e,completedToday:s}:e)}))}));function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.getTimezoneOffset()}var u=s(2821),m=s(75889);function x(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,m.QP)((0,u.$)(t))}function h(e){let{habits:t,selectedHabitId:s,onSelect:i,onOpenCreate:l}=e;return(0,a.jsx)("aside",{className:"sticky top-0 h-[100dvh] w-full border-r border-border/60 bg-card/20 backdrop-blur-xl",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Your habits"}),(0,a.jsx)("h2",{className:"text-lg font-semibold tracking-tight",children:"Dashboard"})]}),(0,a.jsx)("button",{onClick:l,className:"rounded-lg bg-primary text-primary-foreground px-3 py-2 text-sm smooth-transition hover:opacity-95",children:"+ Add"})]}),(0,a.jsxs)("div",{className:"mt-5 space-y-2",children:[0===t.length?(0,a.jsx)("div",{className:"rounded-xl border border-border bg-card/30 p-4 text-sm text-muted-foreground",children:"Create your first habit."}):null,t.map(e=>{let t=e.id===s;return(0,a.jsx)(r.P.button,{onClick:()=>i(e.id),whileHover:{y:-1},whileTap:{scale:.99},className:x("w-full rounded-xl border px-3 py-3 text-left smooth-transition",t?"border-primary/40 bg-primary/10":"border-border bg-card/30 hover:bg-card/50"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium leading-5",children:e.title}),(0,a.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:e.category})]}),(0,a.jsx)("div",{className:x("text-xs",e.isActive?"text-muted-foreground":"text-destructive"),title:e.isActive?"Active":"Disabled",children:e.isActive?"":"Off"})]})},e.id)})]})]})})}var b=s(81152);function g(e){let{open:t,onClose:s,title:l,children:n,footer:d}=e;return i.useEffect(()=>{function e(e){"Escape"===e.key&&s()}return t&&window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,s]),(0,a.jsx)(b.N,{children:t?(0,a.jsxs)(r.P.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:s}),(0,a.jsxs)(r.P.div,{role:"dialog","aria-modal":"true","aria-label":l,className:x("absolute left-1/2 top-1/2 w-[calc(100%-2rem)] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-white/15 bg-card/70 backdrop-blur-xl shadow-glass"),initial:{opacity:0,y:16,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:16,scale:.98},transition:{duration:.2,ease:"easeOut"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3 border-b border-border/60 px-5 py-4",children:[(0,a.jsx)("h2",{className:"text-base font-semibold tracking-tight",children:l}),(0,a.jsx)("button",{onClick:s,className:"rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-foreground/5",children:"Close"})]}),(0,a.jsx)("div",{className:"px-5 py-4",children:n}),d?(0,a.jsx)("div",{className:"border-t border-border/60 px-5 py-4",children:d}):null]})]}):null})}var p=s(54879);let f=i.forwardRef(function(e,t){let{className:s,...i}=e;return(0,a.jsx)("input",{ref:t,className:x("w-full rounded-lg border border-border bg-card/50 px-3 py-2 text-sm outline-none focus-visible:ring-2 focus-visible:ring-ring",s),...i})});function v(e){let{className:t,...s}=e;return(0,a.jsx)("select",{className:x("w-full rounded-lg border border-border bg-card/50 px-3 py-2 text-sm outline-none focus-visible:ring-2 focus-visible:ring-ring",t),...s})}function y(e){let{className:t,variant:s="primary",size:i="md",...r}=e;return(0,a.jsx)("button",{className:x("inline-flex items-center justify-center rounded-lg font-medium smooth-transition focus:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:opacity-60 disabled:pointer-events-none","primary"===s&&"bg-primary text-primary-foreground hover:opacity-95","secondary"===s&&"bg-secondary text-secondary-foreground hover:bg-secondary/80","ghost"===s&&"bg-transparent hover:bg-foreground/5","destructive"===s&&"bg-destructive text-destructive-foreground hover:opacity-95","sm"===i&&"text-sm px-3 py-1.5","md"===i&&"text-sm px-4 py-2.5","lg"===i&&"text-base px-5 py-3",t),...r})}let j=["Health","Study","Fitness","Productivity","Custom"],N=p.gM("type",[p.Ik({type:p.eu("daily")}),p.Ik({type:p.eu("weekly"),daysOfWeek:p.YO(p.ai().int().min(0).max(6)).min(1)}),p.Ik({type:p.eu("custom"),daysOfWeek:p.YO(p.ai().int().min(0).max(6)).min(1)})]),k=p.Ik({title:p.Yj().trim().min(1,"Title is required").max(80),category:p.k5(["Health","Study","Fitness","Productivity","Custom"]),frequency:N,startDate:p.Yj().regex(/^\d{4}-\d{2}-\d{2}$/,"Invalid date"),reminderTime:p.Yj().regex(/^[0-2][0-9]:[0-5][0-9]$/,"Invalid time").optional().or(p.eu("")),isActive:p.zM().optional()}),w=[{v:0,label:"Sun"},{v:1,label:"Mon"},{v:2,label:"Tue"},{v:3,label:"Wed"},{v:4,label:"Thu"},{v:5,label:"Fri"},{v:6,label:"Sat"}];function C(e){var t,s,r,l,n,d,o,c,u;let{initial:m,submitLabel:h,onSubmit:b,onCancel:g,error:p,loading:N}=e,[C,S]=i.useState(null!=(l=m.title)?l:""),[T,D]=i.useState(null!=(n=m.category)?n:"Health"),[I,A]=i.useState(m.startDate),[E,O]=i.useState(null!=(d=m.reminderTime)?d:""),[P,H]=i.useState(null!=(o=null==(t=m.frequency)?void 0:t.type)?o:"daily"),[L,F]=i.useState(m.frequency&&"daily"!==m.frequency.type?m.frequency.daysOfWeek:[1,2,3,4,5]),q=i.useMemo(()=>{var e;let t="daily"===P?{type:"daily"}:{type:P,daysOfWeek:L};return k.safeParse({title:C,category:T,startDate:I,reminderTime:E,frequency:t,isActive:null==(e=m.isActive)||e})},[C,T,I,E,P,L,m.isActive]);return(0,a.jsxs)("form",{onSubmit:function(e){e.preventDefault(),q.success&&b(q.data)},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-sm",children:"Habit name"}),(0,a.jsx)(f,{value:C,onChange:e=>S(e.target.value),placeholder:"e.g., 20 min walk"}),q.success?null:(0,a.jsx)("p",{className:"text-xs text-destructive",children:null!=(c=null==(s=q.error.issues.find(e=>"title"===e.path[0]))?void 0:s.message)?c:""})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-sm",children:"Category"}),(0,a.jsx)(v,{value:T,onChange:e=>D(e.target.value),children:j.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-sm",children:"Start date"}),(0,a.jsx)(f,{value:I,onChange:e=>A(e.target.value),type:"date"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-sm",children:"Frequency"}),(0,a.jsxs)(v,{value:P,onChange:e=>H(e.target.value),children:[(0,a.jsx)("option",{value:"daily",children:"Daily"}),(0,a.jsx)("option",{value:"weekly",children:"Weekly"}),(0,a.jsx)("option",{value:"custom",children:"Custom days"})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{className:"text-sm",children:"Reminder time (optional)"}),(0,a.jsx)(f,{value:E,onChange:e=>O(e.target.value),type:"time"})]})]}),"daily"!==P?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm",children:"Days"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(e=>{let t=L.includes(e.v);return(0,a.jsx)("button",{type:"button",onClick:()=>F(t=>{var s;return s=e.v,t.includes(s)?t.filter(e=>e!==s):[...t,s].sort()}),className:x("rounded-full border px-3 py-1 text-xs smooth-transition",t?"border-primary bg-primary/15 text-foreground":"border-border bg-card/40 text-muted-foreground hover:bg-foreground/5"),children:e.label},e.v)})}),q.success?null:(0,a.jsx)("p",{className:"text-xs text-destructive",children:null!=(u=null==(r=q.error.issues.find(e=>"frequency"===e.path[0]))?void 0:r.message)?u:""})]}):null,p?(0,a.jsx)("div",{className:"rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:p}):null,(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(y,{type:"button",variant:"secondary",onClick:g,disabled:N,children:"Cancel"}),(0,a.jsx)(y,{type:"submit",disabled:N||!q.success,children:N?"Saving…":h})]})]})}function S(e){let{open:t,onClose:s,defaultStartDate:r,onCreated:l}=e,[n,d]=(0,i.useState)(!1),[o,c]=(0,i.useState)(null);async function u(e){c(null),d(!0);try{let t=await fetch("/api/habits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title,category:e.category,frequency:e.frequency,startDate:e.startDate,reminderTime:""===e.reminderTime?void 0:e.reminderTime})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Failed to create habit")}let a=await t.json();l(a.habit),s()}catch(e){var t;c(null!=(t=null==e?void 0:e.message)?t:"Failed to create habit")}finally{d(!1)}}return(0,a.jsx)(g,{open:t,onClose:s,title:"Create habit",children:(0,a.jsx)(C,{initial:{startDate:r},submitLabel:"Create habit",onSubmit:u,onCancel:s,loading:n,error:o})})}function T(e){let{checked:t,disabled:s,onToggle:i}=e;return(0,a.jsxs)("button",{type:"button",disabled:s,onClick:i,className:x("relative flex h-9 w-9 items-center justify-center rounded-xl border border-border bg-card/50 smooth-transition","hover:bg-foreground/5 disabled:opacity-60"),"aria-pressed":t,"aria-label":t?"Mark incomplete":"Mark complete",children:[(0,a.jsx)(r.P.span,{className:x("absolute inset-0 rounded-xl",t?"bg-primary/15":"bg-transparent"),initial:!1,animate:{opacity:+!!t},transition:{duration:.15}}),(0,a.jsx)(r.P.svg,{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:x("relative",t?"text-primary":"text-muted-foreground"),initial:!1,animate:{scale:t?1:.9,opacity:t?1:.7},transition:{type:"spring",stiffness:600,damping:30},children:(0,a.jsx)(r.P.path,{d:"M20 6L9 17l-5-5",initial:!1,animate:{pathLength:+!!t},transition:{duration:.2,ease:"easeOut"}})})]})}var D=s(26991),I=s(86790),A=s(47734),E=s(73697),O=s(23508),P=s(47643);function H(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:x("glass p-5 shadow-glass",t),...s})}function L(e){let{label:t,value:s}=e;return(0,a.jsxs)("div",{className:"rounded-xl border border-border bg-card/40 px-4 py-3",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:t}),(0,a.jsx)("div",{className:"mt-1 text-lg font-semibold tracking-tight",children:s})]})}function F(e){var t,s;let{habit:r}=e,[l,n]=(0,i.useState)(null),d=(0,i.useMemo)(()=>o(),[]),u=(0,i.useMemo)(()=>c(),[]);(0,i.useEffect)(()=>{let e=!1;return(async()=>{n(null);let t=await fetch("/api/habits/".concat(encodeURIComponent(r.id),"/analytics?date=").concat(encodeURIComponent(d),"&tzOffset=").concat(encodeURIComponent(u))),s=await t.json().catch(()=>({error:"Failed"}));e||n(s)})(),()=>{e=!0}},[r.id,d,u]);let m=(null==l?void 0:l.ok)===!0?l.analytics:null;return(0,a.jsxs)(H,{className:"mt-4",children:[(0,a.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-semibold tracking-tight",children:"Analytics"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Streaks and completion trends."})]})}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,a.jsx)(L,{label:"Current streak",value:m?String(m.currentStreak):"…"}),(0,a.jsx)(L,{label:"Best streak",value:m?String(m.bestStreak):"…"}),(0,a.jsx)(L,{label:"Completion (last 30)",value:m?"".concat(m.completionLast30,"%"):"…"})]}),(0,a.jsxs)("div",{className:"mt-4 rounded-xl border border-border bg-card/35 p-3",children:[(0,a.jsx)("div",{className:"mb-2 text-xs text-muted-foreground",children:"Last scheduled days"}),(0,a.jsx)("div",{className:"h-[220px]",children:(0,a.jsx)(D.u,{width:"100%",height:"100%",children:(0,a.jsxs)(I.b,{data:null!=(t=null==m?void 0:m.series)?t:[],margin:{left:8,right:8,top:10,bottom:0},children:[(0,a.jsx)(A.W,{dataKey:"date",tick:{fontSize:10},tickLine:!1,axisLine:!1}),(0,a.jsx)(E.h,{hide:!0,domain:[0,1]}),(0,a.jsx)(O.m,{contentStyle:{background:"rgba(0,0,0,0.6)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,color:"white"},formatter:e=>1===e?"Completed":"Missed"}),(0,a.jsx)(P.N,{type:"monotone",dataKey:"completed",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1,activeDot:{r:4}})]})})})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"History"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Green = completed, gray = missed."}),(0,a.jsx)("div",{className:"mt-3 grid grid-cols-7 gap-2",children:(null!=(s=null==m?void 0:m.series)?s:[]).slice(-28).map(e=>(0,a.jsx)("div",{title:e.date,className:x("h-9 rounded-lg border border-border smooth-transition",1===e.completed?"bg-primary/20":"bg-card/30")},e.date))})]})]})}function q(e){let{habit:t,onUpdated:s,onDeleted:r}=e,[l,n]=(0,i.useState)(!1),[d,o]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),[m,x]=(0,i.useState)(null);async function h(e){var a,i;x(null),u(!0);try{let i=await fetch("/api/habits/".concat(encodeURIComponent(t.id)),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title,category:e.category,frequency:e.frequency,startDate:e.startDate,reminderTime:""===e.reminderTime?null:e.reminderTime,isActive:null!=(a=e.isActive)?a:t.isActive})});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Failed to update habit")}let r=await i.json();s({...t,...r.habit}),n(!1)}catch(e){x(null!=(i=null==e?void 0:e.message)?i:"Failed to update habit")}finally{u(!1)}}async function b(){u(!0),x(null);try{let e=await fetch("/api/habits/".concat(encodeURIComponent(t.id)),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!t.isActive})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error((null==t?void 0:t.error)||"Failed to update")}let a=await e.json();s({...t,...a.habit})}catch(t){var e;x(null!=(e=null==t?void 0:t.message)?e:"Failed to update")}finally{u(!1)}}async function p(){u(!0),x(null);try{let e=await fetch("/api/habits/".concat(encodeURIComponent(t.id)),{method:"DELETE"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error((null==t?void 0:t.error)||"Failed to delete")}r(),o(!1)}catch(t){var e;x(null!=(e=null==t?void 0:t.message)?e:"Failed to delete")}finally{u(!1)}}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(y,{variant:"secondary",size:"sm",onClick:b,disabled:c,children:t.isActive?"Disable":"Enable"}),(0,a.jsx)(y,{variant:"secondary",size:"sm",onClick:()=>n(!0),disabled:c,children:"Edit"}),(0,a.jsx)(y,{variant:"destructive",size:"sm",onClick:()=>o(!0),disabled:c,children:"Delete"})]}),(0,a.jsx)(g,{open:l,onClose:()=>n(!1),title:"Edit: ".concat(t.title),children:(0,a.jsx)(C,{initial:{title:t.title,category:t.category,frequency:t.frequency,startDate:t.startDate,reminderTime:t.reminderTime,isActive:t.isActive},submitLabel:"Save changes",onSubmit:h,onCancel:()=>n(!1),loading:c,error:m})}),(0,a.jsxs)(g,{open:d,onClose:()=>o(!1),title:"Delete habit?",footer:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(y,{variant:"secondary",onClick:()=>o(!1),disabled:c,children:"Cancel"}),(0,a.jsx)(y,{variant:"destructive",onClick:p,disabled:c,children:c?"Deleting…":"Delete"})]}),children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"This permanently removes the habit and its history."}),m?(0,a.jsx)("div",{className:"mt-3 rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:m}):null]})]})}function M(e){let{children:t}=e;return(0,a.jsx)("span",{className:"inline-flex items-center rounded-full border border-border bg-card/40 px-2.5 py-1 text-xs text-muted-foreground",children:t})}function R(){let{email:e}=function(){let[e,t]=i.useState(null),[s,a]=i.useState(!0);return i.useEffect(()=>{let e=!1;return(async()=>{a(!0);let s=await fetch("/api/auth/me"),i=await s.json().catch(()=>({ok:!1}));e||(t(i.ok?i.user.email:null),a(!1))})(),()=>{e=!0}},[]),{email:e,loading:s}}(),t=(0,i.useMemo)(()=>o(),[]),s=(0,i.useMemo)(()=>c(),[]),{habits:l,selectedHabitId:u,setSelectedHabitId:m,refresh:x,loading:b,error:g,upsertLocal:p,removeLocal:f,setCompletedTodayLocal:v}=d(),[j,N]=(0,i.useState)(!1),[k,w]=(0,i.useState)(null);(0,i.useEffect)(()=>{x(t)},[x,t]);let C=(0,i.useMemo)(()=>{var e;return null!=(e=l.find(e=>e.id===u))?e:null},[l,u]),D=(0,i.useMemo)(()=>l.filter(e=>e.isActive).filter(e=>(function(e,t,s){if(t<e.startDate)return!1;let a=e.frequency;if("daily"===a.type)return!0;let[i,r,l]=t.split("-").map(Number),n=new Date(Date.UTC(i,r-1,l)-6e4*s).getUTCDay();return a.daysOfWeek.includes(n)})(e,t,s)),[l,t,s]);async function I(){await fetch("/api/auth/logout",{method:"POST"}),window.location.href="/signin"}async function A(e){if(k)return;w(e.id);let s=!e.completedToday;v(e.id,s);try{(await fetch("/api/habits/".concat(encodeURIComponent(e.id),"/logs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t,completed:s})})).ok||v(e.id,!s)}finally{w(null)}}return(0,a.jsxs)("main",{className:"min-h-screen",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[320px_1fr]",children:[(0,a.jsx)(h,{habits:l,selectedHabitId:u,onSelect:e=>m(e),onOpenCreate:()=>N(!0)}),(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)("div",{className:"sticky top-0 z-40 border-b border-border/60 bg-background/60 backdrop-blur-xl",children:(0,a.jsx)("div",{className:"mx-auto max-w-5xl px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Signed in"}),(0,a.jsx)("div",{className:"text-sm font-medium",children:null!=e?e:"…"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n,{}),(0,a.jsx)(y,{variant:"secondary",size:"sm",onClick:I,children:"Logout"})]})]})})}),(0,a.jsx)("div",{className:"mx-auto max-w-5xl px-6 py-6",children:(0,a.jsxs)(r.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},children:[(0,a.jsxs)(H,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"Today"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[t," (local)"]})]}),(0,a.jsx)(y,{onClick:()=>N(!0),children:"Create habit"})]}),g?(0,a.jsx)("div",{className:"mt-4 rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:g}):null,b?(0,a.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-3",children:Array.from({length:4}).map((e,t)=>(0,a.jsx)("div",{className:"h-14 rounded-xl border border-border bg-foreground/5 animate-pulse-soft"},t))}):(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3",children:[0===D.length?(0,a.jsx)("div",{className:"rounded-xl border border-border bg-card/30 p-4 text-sm text-muted-foreground",children:"No scheduled habits for today. Create one, or adjust frequency."}):null,D.map(e=>(0,a.jsxs)(r.P.div,{whileHover:{y:-1},className:"flex items-center justify-between gap-3 rounded-xl border border-border bg-card/30 px-4 py-3 smooth-transition hover:bg-card/50",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"truncate text-sm font-medium",children:e.title}),(0,a.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,a.jsx)(M,{children:e.category}),e.isActive?null:(0,a.jsx)(M,{children:"Disabled"})]})]}),(0,a.jsx)(T,{checked:!!e.completedToday,disabled:k===e.id,onToggle:()=>A(e)})]},e.id))]})]}),C?(0,a.jsxs)(H,{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h2",{className:"truncate text-lg font-semibold tracking-tight",children:C.title}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,a.jsx)(M,{children:C.category}),(0,a.jsx)(M,{children:C.isActive?"Active":"Disabled"}),C.reminderTime?(0,a.jsxs)(M,{children:["Reminds ",C.reminderTime]}):null,(0,a.jsxs)(M,{children:["Start ",C.startDate]})]})]}),(0,a.jsx)(q,{habit:C,onUpdated:e=>p(e),onDeleted:()=>f(C.id)})]}),(0,a.jsx)(F,{habit:C})]}):(0,a.jsxs)(H,{className:"mt-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold tracking-tight",children:"Select a habit"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Pick one from the sidebar to see analytics and manage it."})]})]})})]})]}),(0,a.jsx)(S,{open:j,onClose:()=>N(!1),defaultStartDate:t,onCreated:e=>{p(e),m(e.id),x(t)}})]})}},95120:(e,t,s)=>{Promise.resolve().then(s.bind(s,78375))}},e=>{e.O(0,[947,964,441,255,358],()=>e(e.s=95120)),_N_E=e.O()}]);