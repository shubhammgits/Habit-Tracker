(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{43797:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var s=a(95155),r=a(12115),i=a(85947),l=a(70344);function n(){let{theme:e,toggle:t}=(0,l.D)();return(0,s.jsxs)("button",{onClick:t,className:"relative inline-flex h-9 w-[74px] items-center rounded-full border border-border bg-card/60 px-1 outline-none focus-visible:ring-2 focus-visible:ring-ring","aria-label":"Toggle theme",children:[(0,s.jsx)(i.P.span,{className:"absolute left-1 top-1 h-7 w-7 rounded-full bg-foreground/10",animate:{x:35*("dark"===e)},transition:{type:"spring",stiffness:500,damping:30}}),(0,s.jsxs)("span",{className:"flex w-full items-center justify-between px-2 text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:"☀"}),(0,s.jsx)("span",{children:"☾"})]})]})}let d=(0,a(95988).vt)(e=>({habits:[],selectedHabitId:null,loading:!1,error:null,setSelectedHabitId:t=>e({selectedHabitId:t}),refresh:async t=>{e({loading:!0,error:null});try{let a=await fetch("/api/habits?date=".concat(encodeURIComponent(t)));if(!a.ok){let e=await a.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Failed to load habits")}let s=await a.json();e(e=>{var t,a;let r=e.selectedHabitId,i=r&&s.habits.some(e=>e.id===r)?r:null!=(a=null==(t=s.habits[0])?void 0:t.id)?a:null;return{habits:s.habits,selectedHabitId:i,loading:!1}})}catch(t){var a;e({loading:!1,error:null!=(a=null==t?void 0:t.message)?a:"Failed to load habits"})}},upsertLocal:t=>e(e=>{var a;return{habits:[t,...e.habits.filter(e=>e.id!==t.id)],selectedHabitId:null!=(a=e.selectedHabitId)?a:t.id}}),removeLocal:t=>e(e=>{var a,s;return{habits:e.habits.filter(e=>e.id!==t),selectedHabitId:e.selectedHabitId===t?null!=(s=null==(a=e.habits.find(e=>e.id!==t))?void 0:a.id)?s:null:e.selectedHabitId}}),setCompletedTodayLocal:(t,a)=>e(e=>({habits:e.habits.map(e=>e.id===t?{...e,completedToday:a}:e)}))}));function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.getTimezoneOffset()}function u(e,t,a){if(t<e.startDate)return!1;let s=e.frequency;if("daily"===s.type)return!0;let[r,i,l]=t.split("-").map(Number),n=new Date(Date.UTC(r,i-1,l)-6e4*a).getUTCDay();return s.daysOfWeek.includes(n)}var m=a(2821),x=a(75889);function h(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,x.QP)((0,m.$)(t))}function b(e){let{habits:t,selectedHabitId:a,onSelect:r,onOpenCreate:l}=e;return(0,s.jsx)("aside",{className:"sticky top-0 h-[100dvh] w-full border-r border-border/60 bg-card/20 backdrop-blur-xl",children:(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Your habits"}),(0,s.jsx)("h2",{className:"text-lg font-semibold tracking-tight",children:"Dashboard"})]}),(0,s.jsx)("button",{onClick:l,className:"rounded-lg bg-primary text-primary-foreground px-3 py-2 text-sm smooth-transition hover:opacity-95",children:"+ Add"})]}),(0,s.jsxs)("div",{className:"mt-5 space-y-2",children:[0===t.length?(0,s.jsx)("div",{className:"rounded-xl border border-border bg-card/30 p-4 text-sm text-muted-foreground",children:"Create your first habit."}):null,t.map(e=>{let t=e.id===a;return(0,s.jsx)(i.P.button,{onClick:()=>r(e.id),whileHover:{y:-1},whileTap:{scale:.99},className:h("w-full rounded-xl border px-3 py-3 text-left smooth-transition",t?"border-primary/40 bg-primary/10":"border-border bg-card/30 hover:bg-card/50"),children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium leading-5",children:e.title}),(0,s.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:e.category})]}),(0,s.jsx)("div",{className:h("text-xs",e.isActive?"text-muted-foreground":"text-destructive"),title:e.isActive?"Active":"Disabled",children:e.isActive?"":"Off"})]})},e.id)})]})]})})}var p=a(81152);function g(e){let{open:t,onClose:a,title:l,children:n,footer:d}=e;return r.useEffect(()=>{function e(e){"Escape"===e.key&&a()}return t&&window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,a]),(0,s.jsx)(p.N,{children:t?(0,s.jsxs)(i.P.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:a}),(0,s.jsxs)(i.P.div,{role:"dialog","aria-modal":"true","aria-label":l,className:h("absolute left-1/2 top-1/2 w-[calc(100%-2rem)] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-white/15 bg-card/70 backdrop-blur-xl shadow-glass"),initial:{opacity:0,y:16,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:16,scale:.98},transition:{duration:.2,ease:"easeOut"},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 border-b border-border/60 px-5 py-4",children:[(0,s.jsx)("h2",{className:"text-base font-semibold tracking-tight",children:l}),(0,s.jsx)("button",{onClick:a,className:"rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-foreground/5",children:"Close"})]}),(0,s.jsx)("div",{className:"px-5 py-4",children:n}),d?(0,s.jsx)("div",{className:"border-t border-border/60 px-5 py-4",children:d}):null]})]}):null})}var f=a(54879);let v=r.forwardRef(function(e,t){let{className:a,...r}=e;return(0,s.jsx)("input",{ref:t,className:h("w-full rounded-lg border border-border bg-card/50 px-3 py-2 text-sm outline-none focus-visible:ring-2 focus-visible:ring-ring",a),...r})});function y(e){let{className:t,...a}=e;return(0,s.jsx)("select",{className:h("w-full rounded-lg border border-border bg-card/50 px-3 py-2 text-sm outline-none focus-visible:ring-2 focus-visible:ring-ring",t),...a})}function j(e){let{className:t,variant:a="primary",size:r="md",...i}=e;return(0,s.jsx)("button",{className:h("inline-flex items-center justify-center rounded-lg font-medium smooth-transition focus:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:opacity-60 disabled:pointer-events-none","primary"===a&&"bg-primary text-primary-foreground hover:opacity-95","secondary"===a&&"bg-secondary text-secondary-foreground hover:bg-secondary/80","ghost"===a&&"bg-transparent hover:bg-foreground/5","destructive"===a&&"bg-destructive text-destructive-foreground hover:opacity-95","sm"===r&&"text-sm px-3 py-1.5","md"===r&&"text-sm px-4 py-2.5","lg"===r&&"text-base px-5 py-3",t),...i})}let N=["Health","Study","Fitness","Productivity","Custom"],w=f.gM("type",[f.Ik({type:f.eu("daily")}),f.Ik({type:f.eu("weekly"),daysOfWeek:f.YO(f.ai().int().min(0).max(6)).min(1)}),f.Ik({type:f.eu("custom"),daysOfWeek:f.YO(f.ai().int().min(0).max(6)).min(1)})]),k=f.Ik({title:f.Yj().trim().min(1,"Title is required").max(80),category:f.k5(["Health","Study","Fitness","Productivity","Custom"]),frequency:w,startDate:f.Yj().regex(/^\d{4}-\d{2}-\d{2}$/,"Invalid date"),reminderTime:f.Yj().regex(/^[0-2][0-9]:[0-5][0-9]$/,"Invalid time").optional().or(f.eu("")),isActive:f.zM().optional()}),C=[{v:0,label:"Sun"},{v:1,label:"Mon"},{v:2,label:"Tue"},{v:3,label:"Wed"},{v:4,label:"Thu"},{v:5,label:"Fri"},{v:6,label:"Sat"}];function S(e){var t,a,i,l,n,d,o,c,u;let{initial:m,submitLabel:x,onSubmit:b,onCancel:p,error:g,loading:f}=e,[w,S]=r.useState(null!=(l=m.title)?l:""),[D,T]=r.useState(null!=(n=m.category)?n:"Health"),[A,M]=r.useState(m.startDate),[I,E]=r.useState(null!=(d=m.reminderTime)?d:""),[O,L]=r.useState(null!=(o=null==(t=m.frequency)?void 0:t.type)?o:"daily"),[P,R]=r.useState(m.frequency&&"daily"!==m.frequency.type?m.frequency.daysOfWeek:[1,2,3,4,5]),U=r.useMemo(()=>{var e;let t="daily"===O?{type:"daily"}:{type:O,daysOfWeek:P};return k.safeParse({title:w,category:D,startDate:A,reminderTime:I,frequency:t,isActive:null==(e=m.isActive)||e})},[w,D,A,I,O,P,m.isActive]);return(0,s.jsxs)("form",{onSubmit:function(e){e.preventDefault(),U.success&&b(U.data)},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",children:"Habit name"}),(0,s.jsx)(v,{value:w,onChange:e=>S(e.target.value),placeholder:"e.g., 20 min walk"}),U.success?null:(0,s.jsx)("p",{className:"text-xs text-destructive",children:null!=(c=null==(a=U.error.issues.find(e=>"title"===e.path[0]))?void 0:a.message)?c:""})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",children:"Category"}),(0,s.jsx)(y,{value:D,onChange:e=>T(e.target.value),children:N.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",children:"Start date"}),(0,s.jsx)(v,{value:A,onChange:e=>M(e.target.value),type:"date"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",children:"Frequency"}),(0,s.jsxs)(y,{value:O,onChange:e=>L(e.target.value),children:[(0,s.jsx)("option",{value:"daily",children:"Daily"}),(0,s.jsx)("option",{value:"weekly",children:"Weekly"}),(0,s.jsx)("option",{value:"custom",children:"Custom days"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",children:"Reminder time (optional)"}),(0,s.jsx)(v,{value:I,onChange:e=>E(e.target.value),type:"time"})]})]}),"daily"!==O?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Days"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:C.map(e=>{let t=P.includes(e.v);return(0,s.jsx)("button",{type:"button",onClick:()=>R(t=>{var a;return a=e.v,t.includes(a)?t.filter(e=>e!==a):[...t,a].sort()}),className:h("rounded-full border px-3 py-1 text-xs smooth-transition",t?"border-primary bg-primary/15 text-foreground":"border-border bg-card/40 text-muted-foreground hover:bg-foreground/5"),children:e.label},e.v)})}),U.success?null:(0,s.jsx)("p",{className:"text-xs text-destructive",children:null!=(u=null==(i=U.error.issues.find(e=>"frequency"===e.path[0]))?void 0:i.message)?u:""})]}):null,g?(0,s.jsx)("div",{className:"rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:g}):null,(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(j,{type:"button",variant:"secondary",onClick:p,disabled:f,children:"Cancel"}),(0,s.jsx)(j,{type:"submit",disabled:f||!U.success,children:f?"Saving…":x})]})]})}function D(e){let{open:t,onClose:a,defaultStartDate:i,onCreated:l}=e,[n,d]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null);async function u(e){c(null),d(!0);try{let t=await fetch("/api/habits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title,category:e.category,frequency:e.frequency,startDate:e.startDate,reminderTime:""===e.reminderTime?void 0:e.reminderTime})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Failed to create habit")}let s=await t.json();l(s.habit),a()}catch(e){var t;c(null!=(t=null==e?void 0:e.message)?t:"Failed to create habit")}finally{d(!1)}}return(0,s.jsx)(g,{open:t,onClose:a,title:"Create habit",children:(0,s.jsx)(S,{initial:{startDate:i},submitLabel:"Create habit",onSubmit:u,onCancel:a,loading:n,error:o})})}function T(e){let{checked:t,disabled:a,onToggle:r}=e;return(0,s.jsxs)("button",{type:"button",disabled:a,onClick:r,className:h("relative flex h-9 w-9 items-center justify-center rounded-xl border border-border bg-card/50 smooth-transition","hover:bg-foreground/5 disabled:opacity-60"),"aria-pressed":t,"aria-label":t?"Mark incomplete":"Mark complete",children:[(0,s.jsx)(i.P.span,{className:h("absolute inset-0 rounded-xl",t?"bg-primary/15":"bg-transparent"),initial:!1,animate:{opacity:+!!t},transition:{duration:.15}}),(0,s.jsx)(i.P.svg,{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:h("relative",t?"text-primary":"text-muted-foreground"),initial:!1,animate:{scale:t?1:.9,opacity:t?1:.7},transition:{type:"spring",stiffness:600,damping:30},children:(0,s.jsx)(i.P.path,{d:"M20 6L9 17l-5-5",initial:!1,animate:{pathLength:+!!t},transition:{duration:.2,ease:"easeOut"}})})]})}var A=a(26991),M=a(80019),I=a(47734),E=a(73697),O=a(23508),L=a(47643);function P(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:h("glass p-5 shadow-glass",t),...a})}var R=a(27893),U=a(80651),F=a(73620),H=a(70524),q=a(28834),z=a(64803),W=a(87260);function _(e){let{label:t,value:a}=e;return(0,s.jsxs)("div",{className:"rounded-xl border border-border bg-card/40 px-4 py-3",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:t}),(0,s.jsx)("div",{className:"mt-1 text-lg font-semibold tracking-tight",children:a})]})}function Y(e){var t;let{habit:a}=e,[l,n]=(0,r.useState)(null),[d,m]=(0,r.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}),[x,b]=(0,r.useState)({}),p=(0,r.useMemo)(()=>o(),[]),g=(0,r.useMemo)(()=>c(),[]);(0,r.useEffect)(()=>{let e=!1;return(async()=>{n(null);let t=await fetch("/api/habits/".concat(encodeURIComponent(a.id),"/analytics?date=").concat(encodeURIComponent(p),"&tzOffset=").concat(encodeURIComponent(g))),s=await t.json().catch(()=>({error:"Failed"}));e||n(s)})(),()=>{e=!0}},[a.id,p,g]);let f=(0,r.useMemo)(()=>({start:(0,R.A)((0,U.A)(d),{weekStartsOn:0}),end:(0,F.A)((0,H.A)(d),{weekStartsOn:0})}),[d]);(0,r.useEffect)(()=>{let e=!1;return(async()=>{let t=(0,q.A)(f.start,"yyyy-MM-dd"),s=(0,q.A)(f.end,"yyyy-MM-dd"),r=await fetch("/api/habits/".concat(encodeURIComponent(a.id),"/logs?start=").concat(encodeURIComponent(t),"&end=").concat(encodeURIComponent(s))),i=await r.json().catch(()=>({error:"Failed"}));if(e)return;if(!0!==i.ok)return b({});let l={};for(let e of i.logs)l[e.date]=!!e.completed;b(l)})(),()=>{e=!0}},[a.id,f.end,f.start]);let v=(null==l?void 0:l.ok)===!0?l.analytics:null,y=(0,r.useMemo)(()=>{let e=new Date,t=[];for(let a=0;a<7;a++){let s=(0,z.A)(e,6-a);t.push({ymd:(0,q.A)(s,"yyyy-MM-dd"),label:(0,q.A)(s,"EEE")})}return t},[]),j=(0,r.useMemo)(()=>{let e=0,t=0,s=y.map(s=>{let r=u(a,s.ymd,g),i=!0===x[s.ymd];return r&&(e++,i&&t++),{...s,scheduled:r,completed:i}});return{scheduled:e,completed:t,items:s}},[a,x,g,y]),N=(0,r.useMemo)(()=>{let e=[],t=new Date(f.start);for(;t<=f.end;)e.push({date:new Date(t),ymd:(0,q.A)(t,"yyyy-MM-dd")}),t.setDate(t.getDate()+1);return e},[f.end,f.start]);return(0,s.jsxs)(P,{className:"mt-4",children:[(0,s.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-base font-semibold tracking-tight",children:"Analytics"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Streaks and completion trends."})]})}),(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,s.jsx)(_,{label:"Current streak",value:v?String(v.currentStreak):"…"}),(0,s.jsx)(_,{label:"Best streak",value:v?String(v.bestStreak):"…"}),(0,s.jsx)(_,{label:"Completion (last 30)",value:v?"".concat(v.completionLast30,"%"):"…"})]}),(0,s.jsxs)("div",{className:"mt-4 rounded-xl border border-border bg-card/35 p-3",children:[(0,s.jsx)("div",{className:"mb-2 text-xs text-muted-foreground",children:"Last scheduled days"}),(0,s.jsx)("div",{className:"h-[220px]",children:(0,s.jsx)(A.u,{width:"100%",height:"100%",children:(0,s.jsxs)(M.b,{data:null!=(t=null==v?void 0:v.series)?t:[],margin:{left:8,right:8,top:10,bottom:0},children:[(0,s.jsx)(I.W,{dataKey:"date",tick:{fontSize:10},tickLine:!1,axisLine:!1}),(0,s.jsx)(E.h,{hide:!0,domain:[0,1]}),(0,s.jsx)(O.m,{contentStyle:{background:"rgba(0,0,0,0.6)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,color:"white"},formatter:e=>1===e?"Completed":"Missed"}),(0,s.jsx)(L.N,{type:"monotone",dataKey:"completed",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1,activeDot:{r:4}})]})})})]}),(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"This week"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Scheduled days only."}),(0,s.jsxs)("div",{className:"mt-3 rounded-xl border border-border bg-card/30 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[j.completed,"/",j.scheduled," completed"]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[j.scheduled?Math.round(j.completed/j.scheduled*100):0,"%"]})]}),(0,s.jsx)("div",{className:"mt-2 h-2 w-full rounded-full bg-foreground/10",children:(0,s.jsx)("div",{className:"h-2 rounded-full bg-primary smooth-transition",style:{width:"".concat(j.scheduled?j.completed/j.scheduled*100:0,"%")}})}),(0,s.jsx)("div",{className:"mt-4 grid grid-cols-7 gap-2",children:j.items.map(e=>(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground",children:e.label}),(0,s.jsx)("div",{className:h("mt-2 h-9 rounded-lg border border-border",!e.scheduled&&"bg-card/15 opacity-70",e.scheduled&&e.completed&&"bg-primary/20",e.scheduled&&!e.completed&&"bg-card/30"),title:e.ymd})]},e.ymd))})]})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Monthly calendar"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Color-coded scheduled completion states."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>m(e=>(0,W.A)(e,-1)),className:"rounded-lg border border-border bg-card/40 px-3 py-1.5 text-sm hover:bg-foreground/5","aria-label":"Previous month",children:"Prev"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,q.A)(d,"MMMM yyyy")}),(0,s.jsx)("button",{type:"button",onClick:()=>m(e=>(0,W.A)(e,1)),className:"rounded-lg border border-border bg-card/40 px-3 py-1.5 text-sm hover:bg-foreground/5","aria-label":"Next month",children:"Next"})]})]}),(0,s.jsx)("div",{className:"mt-3 grid grid-cols-7 gap-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,s.jsx)("div",{className:"text-center text-[10px] text-muted-foreground",children:e},e))}),(0,s.jsx)(i.P.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18,ease:"easeOut"},className:"mt-2 grid grid-cols-7 gap-2",children:N.map(e=>{let t=e.date.getMonth()===d.getMonth(),r=u(a,e.ymd,g),i=!0===x[e.ymd],l=e.ymd<a.startDate;return(0,s.jsxs)("div",{title:e.ymd,className:h("relative h-11 rounded-xl border border-border bg-card/20 p-2 smooth-transition",!t&&"opacity-60",l&&"opacity-50",r&&i&&"bg-primary/20",r&&!i&&"bg-card/35",!r&&"bg-card/15","hover:bg-foreground/5"),children:[(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground",children:e.date.getDate()}),r?(0,s.jsx)("div",{className:h("absolute bottom-2 right-2 h-2 w-2 rounded-full",i?"bg-primary":"bg-foreground/20")}):null]},e.ymd)})},(0,q.A)(d,"yyyy-MM"))]})]})}function J(e){let{habit:t,onUpdated:a,onDeleted:i}=e,[l,n]=(0,r.useState)(!1),[d,o]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null);async function h(e){var s,r;x(null),u(!0);try{let r=await fetch("/api/habits/".concat(encodeURIComponent(t.id)),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title,category:e.category,frequency:e.frequency,startDate:e.startDate,reminderTime:""===e.reminderTime?null:e.reminderTime,isActive:null!=(s=e.isActive)?s:t.isActive})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Failed to update habit")}let i=await r.json();a({...t,...i.habit}),n(!1)}catch(e){x(null!=(r=null==e?void 0:e.message)?r:"Failed to update habit")}finally{u(!1)}}async function b(){u(!0),x(null);try{let e=await fetch("/api/habits/".concat(encodeURIComponent(t.id)),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!t.isActive})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error((null==t?void 0:t.error)||"Failed to update")}let s=await e.json();a({...t,...s.habit})}catch(t){var e;x(null!=(e=null==t?void 0:t.message)?e:"Failed to update")}finally{u(!1)}}async function p(){u(!0),x(null);try{let e=await fetch("/api/habits/".concat(encodeURIComponent(t.id)),{method:"DELETE"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error((null==t?void 0:t.error)||"Failed to delete")}i(),o(!1)}catch(t){var e;x(null!=(e=null==t?void 0:t.message)?e:"Failed to delete")}finally{u(!1)}}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)(j,{variant:"secondary",size:"sm",onClick:b,disabled:c,children:t.isActive?"Disable":"Enable"}),(0,s.jsx)(j,{variant:"secondary",size:"sm",onClick:()=>n(!0),disabled:c,children:"Edit"}),(0,s.jsx)(j,{variant:"destructive",size:"sm",onClick:()=>o(!0),disabled:c,children:"Delete"})]}),(0,s.jsx)(g,{open:l,onClose:()=>n(!1),title:"Edit: ".concat(t.title),children:(0,s.jsx)(S,{initial:{title:t.title,category:t.category,frequency:t.frequency,startDate:t.startDate,reminderTime:t.reminderTime,isActive:t.isActive},submitLabel:"Save changes",onSubmit:h,onCancel:()=>n(!1),loading:c,error:m})}),(0,s.jsxs)(g,{open:d,onClose:()=>o(!1),title:"Delete habit?",footer:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(j,{variant:"secondary",onClick:()=>o(!1),disabled:c,children:"Cancel"}),(0,s.jsx)(j,{variant:"destructive",onClick:p,disabled:c,children:c?"Deleting…":"Delete"})]}),children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"This permanently removes the habit and its history."}),m?(0,s.jsx)("div",{className:"mt-3 rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:m}):null]})]})}var K=a(73850),B=a(77568);function $(e){let{label:t,value:a}=e;return(0,s.jsxs)("div",{className:"rounded-xl border border-border bg-card/40 px-4 py-3",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:t}),(0,s.jsx)("div",{className:"mt-1 text-lg font-semibold tracking-tight",children:a})]})}function Q(e){var t,a;let{ymd:i,tzOffset:l}=e,[n,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=!1;return(async()=>{let t=await fetch("/api/analytics/overview?date=".concat(encodeURIComponent(i),"&tzOffset=").concat(encodeURIComponent(l))),a=await t.json().catch(()=>({error:"Failed"}));e||d(a)})(),()=>{e=!0}},[i,l]);let o=n&&"ok"in n&&n.ok?n.overview:null;return(0,s.jsxs)(P,{children:[(0,s.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold tracking-tight",children:"Overview"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"All active habits, last 14 days trend."})]})}),(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,s.jsx)($,{label:"Active habits",value:o?String(o.activeHabits):"…"}),(0,s.jsx)($,{label:"Completion (last 30)",value:o?"".concat(o.completionLast30,"%"):"…"}),(0,s.jsx)($,{label:"Perfect-day streak",value:o?String(o.perfectStreak):"…"})]}),(0,s.jsxs)("div",{className:"mt-4 rounded-xl border border-border bg-card/35 p-3",children:[(0,s.jsx)("div",{className:"mb-2 text-xs text-muted-foreground",children:"Completion rate (last 14)"}),(0,s.jsx)("div",{className:"h-[200px]",children:(0,s.jsx)(A.u,{width:"100%",height:"100%",children:(0,s.jsxs)(K.Q,{data:null!=(a=null==o?void 0:o.last14)?a:[],margin:{left:8,right:8,top:10,bottom:0},children:[(0,s.jsx)(I.W,{dataKey:"date",tick:{fontSize:10},tickLine:!1,axisLine:!1}),(0,s.jsx)(E.h,{hide:!0,domain:[0,1]}),(0,s.jsx)(O.m,{formatter:e=>"".concat(Math.round(100*Number(e)),"%")}),(0,s.jsx)(B.G,{type:"monotone",dataKey:"completionRate",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary) / 0.25)"})]})})})]}),(null==o||null==(t=o.badges)?void 0:t.length)?(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Badges"}),(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:o.badges.map(e=>(0,s.jsx)("span",{title:e.description,className:"inline-flex items-center rounded-full border border-border bg-primary/10 px-3 py-1 text-xs",children:e.title},e.id))})]}):null]})}function G(e){let{children:t}=e;return(0,s.jsx)("span",{className:"inline-flex items-center rounded-full border border-border bg-card/40 px-2.5 py-1 text-xs text-muted-foreground",children:t})}function V(){let{email:e}=function(){let[e,t]=r.useState(null),[a,s]=r.useState(!0);return r.useEffect(()=>{let e=!1;return(async()=>{s(!0);let a=await fetch("/api/auth/me"),r=await a.json().catch(()=>({ok:!1}));e||(t(r.ok?r.user.email:null),s(!1))})(),()=>{e=!0}},[]),{email:e,loading:a}}(),{ymd:t,tzOffset:a}=function(){let[e,t]=r.useState(()=>o()),[a,s]=r.useState(()=>c());return r.useEffect(()=>{let e=null,a=()=>{let r=new Date;e=window.setTimeout(()=>{t(o()),s(c()),a()},function(e){let t=new Date(e);return t.setHours(24,0,0,50),t.getTime()-e.getTime()}(r))};return a(),()=>{e&&window.clearTimeout(e)}},[]),{ymd:e,tzOffset:a}}(),{habits:l,selectedHabitId:m,setSelectedHabitId:x,refresh:h,loading:p,error:g,upsertLocal:f,removeLocal:v,setCompletedTodayLocal:y}=d(),[N,w]=(0,r.useState)(!1),[k,C]=(0,r.useState)(null);(0,r.useEffect)(()=>{h(t)},[h,t]);let S=(0,r.useMemo)(()=>{var e;return null!=(e=l.find(e=>e.id===m))?e:null},[l,m]),A=(0,r.useMemo)(()=>l.filter(e=>e.isActive).filter(e=>u(e,t,a)),[l,t,a]);async function M(){await fetch("/api/auth/logout",{method:"POST"}),window.location.href="/signin"}async function I(e){if(k)return;C(e.id);let a=!e.completedToday;y(e.id,a);try{(await fetch("/api/habits/".concat(encodeURIComponent(e.id),"/logs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t,completed:a})})).ok||y(e.id,!a)}finally{C(null)}}async function E(){let e="/api/export/csv?date=".concat(encodeURIComponent(t),"&tzOffset=").concat(encodeURIComponent(a),"&days=180"),s=await fetch(e);if(!s.ok)return;let r=await s.blob(),i=URL.createObjectURL(r),l=document.createElement("a");l.href=i,l.download="habit-tracker-export_".concat(t,".csv"),document.body.appendChild(l),l.click(),l.remove(),setTimeout(()=>URL.revokeObjectURL(i),1e4)}return(0,s.jsxs)("main",{className:"min-h-screen",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[320px_1fr]",children:[(0,s.jsx)(b,{habits:l,selectedHabitId:m,onSelect:e=>x(e),onOpenCreate:()=>w(!0)}),(0,s.jsxs)("div",{className:"min-h-screen",children:[(0,s.jsx)("div",{className:"sticky top-0 z-40 border-b border-border/60 bg-background/60 backdrop-blur-xl",children:(0,s.jsx)("div",{className:"mx-auto max-w-5xl px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Signed in"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:null!=e?e:"…"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n,{}),(0,s.jsx)(j,{variant:"secondary",size:"sm",onClick:M,children:"Logout"})]})]})})}),(0,s.jsx)("div",{className:"mx-auto max-w-5xl px-6 py-6",children:(0,s.jsxs)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},children:[(0,s.jsxs)(P,{children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"Today"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[t," (local)"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j,{variant:"secondary",onClick:E,children:"Export CSV"}),(0,s.jsx)(j,{onClick:()=>w(!0),children:"Create habit"})]})]}),g?(0,s.jsx)("div",{className:"mt-4 rounded-lg border border-destructive/30 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:g}):null,p?(0,s.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-3",children:Array.from({length:4}).map((e,t)=>(0,s.jsx)("div",{className:"h-14 rounded-xl border border-border bg-foreground/5 animate-pulse-soft"},t))}):(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3",children:[0===A.length?(0,s.jsx)("div",{className:"rounded-xl border border-border bg-card/30 p-4 text-sm text-muted-foreground",children:"No scheduled habits for today. Create one, or adjust frequency."}):null,A.map(e=>(0,s.jsxs)(i.P.div,{whileHover:{y:-1},className:"flex items-center justify-between gap-3 rounded-xl border border-border bg-card/30 px-4 py-3 smooth-transition hover:bg-card/50",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"truncate text-sm font-medium",children:e.title}),(0,s.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,s.jsx)(G,{children:e.category}),e.isActive?null:(0,s.jsx)(G,{children:"Disabled"})]})]}),(0,s.jsx)(T,{checked:!!e.completedToday,disabled:k===e.id,onToggle:()=>I(e)})]},e.id))]})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(Q,{ymd:t,tzOffset:a})}),S?(0,s.jsxs)(P,{className:"mt-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("h2",{className:"truncate text-lg font-semibold tracking-tight",children:S.title}),(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,s.jsx)(G,{children:S.category}),(0,s.jsx)(G,{children:S.isActive?"Active":"Disabled"}),S.reminderTime?(0,s.jsxs)(G,{children:["Reminds ",S.reminderTime]}):null,(0,s.jsxs)(G,{children:["Start ",S.startDate]})]})]}),(0,s.jsx)(J,{habit:S,onUpdated:e=>f(e),onDeleted:()=>v(S.id)})]}),(0,s.jsx)(Y,{habit:S})]}):(0,s.jsxs)(P,{className:"mt-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold tracking-tight",children:"Select a habit"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Pick one from the sidebar to see analytics and manage it."})]})]})})]})]}),(0,s.jsx)(D,{open:N,onClose:()=>w(!1),defaultStartDate:t,onCreated:e=>{f(e),x(e.id),h(t)}})]})}},70344:(e,t,a)=>{"use strict";a.d(t,{D:()=>l,ThemeProvider:()=>i});var s=a(12115);function r(e){document.documentElement.classList.toggle("dark","dark"===e)}function i(e){let{children:t}=e;return s.useEffect(()=>{var e,t,a;let s=null!=(a=localStorage.getItem("ht_theme"))?a:null,i=null==(e=(t=window).matchMedia)?void 0:e.call(t,"(prefers-color-scheme: dark)").matches;r(null!=s?s:i?"dark":"light")},[]),t}function l(){let[e,t]=s.useState("light");s.useEffect(()=>{t(document.documentElement.classList.contains("dark")?"dark":"light")},[]);let a=s.useCallback(()=>{let a="dark"===e?"light":"dark";t(a),localStorage.setItem("ht_theme",a),r(a)},[e]);return{theme:e,toggle:a}}},95120:(e,t,a)=>{Promise.resolve().then(a.bind(a,43797))}},e=>{e.O(0,[947,706,441,255,358],()=>e(e.s=95120)),_N_E=e.O()}]);